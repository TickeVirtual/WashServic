
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket de Compra</title>
    <style>
      * {
        font-family: tahoma, Helvetica, sans-serif; /* tipo de letra de todo el ticket; */
        font-size: 3.5mm !important;
        line-height: 1 !important;
      }

      .info-tienda {
        margin-top: 0;
        margin-bottom:0mm;
        line-height: 4mm;
      }

      .nro_boleta {
        margin: 0;
        font-size: 10mm !important;
      }

      .fecha_recepcion {
        margin: 0;
      }
      .fecha_entrega {
        line-height: 5mm;
        margin: 0;
      }

      .nombre-cliente {
        margin: 0mm;
        margin-top: 0;
        font-size: 4.5mm !important;
      }

      #thermal-pos {
        box-shadow: 0 0 5mm #eee;
        margin: 0 auto;
        max-width: 79mm;
        /* line-height: 6mm; */
        padding: 3mm;
      }

      #thermal-pos h2 {
        font-size: 2mm;
        line-height: 13px;
        font-weight: normal; /* Agrega esta línea para desactivar la negrita */
      }
      .label {
        margin: 0;
      }
         .ticket {
    text-align: center;
   Padding-top: 0; /* Elimina el margen superior */
   Padding-bottom: 0; /* Elimina el margen inferior */
   Padding-right: 0;
   Padding-left: 0;
    

    }
       .fecharecep {
    text-align: center;
   Padding-top: 0; /* Elimina el margen superior */
   Padding-bottom: 0; /* Elimina el margen inferior */
   Padding-right: 0;
   Padding-left: 0;
    

    }

      #thermal-pos .label {
        text-align: center;
        font-size: 2mm;
      }
      #thermal-pos .line {
        text-align: center;
        line-height: 0;
        font-size: 1mm;
      }

      #thermal-pos .detalles {
        vertical-align: text-top;
        max-width: 35mm;
        word-wrap: break-word;
      }

      #thermal .listitem {
        font-size: 2mm;
        height: 5mm;
      }

      #thermal-pos table {
        font-size: 2mm;
        height: 5mm;
        border-collapse: collapse;
      }

      #thermal-pos .item {
        max-width: 30mm;
        font-size: 2.1mm;
        text-align: start;
        word-wrap: break-word;
        font-weight: normal; /* Agrega esta línea para desactivar la negrita */
      }

      #thermal-pos .cantidad {
        text-align: right;
      }

      #thermal-pos .footer {
        margin-top: 5mm;
        text-align: center;
        height: 60px;
        page-break-after: auto;
      }

      .table {
        width: 100%;
        text-align: right;
      }

      .table-header {
        text-align: right;
        border-top: groove; /* Raya superior de encabezado de tabla de detalles; */
        border-bottom: groove; /* Raya inferior de encabezado de tabla de detalles; */
        
        
        
      }

      .table-header h2 {
        margin: 0;
      }

      .table-item {
        vertical-align: top;
      }
      /* raya superior de SUBTOTAL; */
      .top-line {
        border-top: groove;
      }

      .pt-2 {
        padding-top: 2mm;
      }

      .saldo-text {
        margin: 0;
        font-size: 15mm;
        text-align: center;
      } 

      .table-footer {
        vertical-align: bottom;
        text-align: right;
        font-size: 2mm;
        line-height: 2mm;
      }

      .table-footer h2 {
        margin: 0;
        font-size: 2mm;
      }

      .estado-deuda {
        font-size: 8mm !important;
      }

      .info {
        font-size: 1.6mm;
      }
      .info p {
        padding-bottom: 0;
        margin-bottom: 0;
      }
      
      .align-left {
        text-align: left;
     }
     

      .m-0 {
        margin: 0 !important;
        font-weight: normal; /* Agrega esta línea para desactivar la negrita */
        text-align: left;
      }

      .policy {
        font-size: 1.5mm;
        line-height: 3.5mm;
        padding: 3mm;
        padding-top: 0;
      }

      .policy .policy-title {
        text-align: center;
        margin: 0;
        font-weight: normal; /* Agrega esta línea para desactivar la negrita */
        
      }
      
      .align-right {
            text-align: right;
        }
/* ---------------------------------------------------------------------------------------------- */

.button-container {
  display: flex;
  justify-content: center; /* Centrar horizontalmente */
}

.button-box {
  max-width: 300px; /* Ancho máximo del contenedor */
  display: flex;
  justify-content: space-between; /* Espacio entre las imágenes */
}

.button-box img {
  max-width: 100%; /* Tamaño máximo de las imágenes */
}

/* Estilo para ocultar los botones en la versión impresa */
@media print {
  #whatsappButton,
  #impresoraButton {
    display: none;
  }


/* CSS para ocultar las imágenes de WhatsAppButton cuando sharelink=1 está presente en la URL */
img#whatsappButton {
    display: none;
}

/* CSS para ocultar las imágenes de WhatsAppButton cuando sharelink=1 está presente en la URL */
img#impresoraButton {
    display: none;
}

/* ------------------------------------------------------------------------------------------------- */

      
    </style>
 </head>

      <!-- <body onload="window.print()" onfocus="window.close()" -->
      
        <!--<button id="whatsappButton">ENVIAR WHATSAPP</button>
       <!--<button id="Imprimirr">Print</button>-->


    <script>
        // Obtener los parámetros de la URL
        const params = new URLSearchParams(window.location.search);

        // Obtener los valores de los parámetros
        var nro_boleta = params.has('boleta') ? params.get('boleta') : "---";
        var nombre_cliente = params.has('cliente') ? params.get('cliente') : "==Cliente==";
        var telefono = params.has('telefono') ? params.get('telefono') : "==Cliente==";
        var codigo_pais = params.has('codigo_pais') ? params.get('codigo_pais') : "+51";
        var fecha = params.has('fecha') ? params.get('fecha') : "dd/mm/aaaa hh:mm:ss";
        var fecha_entrega = params.has('fecha_entrega') ? params.get('fecha_entrega') : "hh:mm:ss";
        var total = params.has('total') ? params.get('total') : "";
        var subtotal_desc = params.has('subtotal_desc') ? params.get('subtotal_desc') : " ";
        var total_a_pagar = params.has('total_a_pagar') ? params.get('total_a_pagar') : " ";
        var descuento = params.has('descuento') ? params.get('descuento') : " ";
        var a_cuenta = params.has('a_cuenta') ? params.get('a_cuenta') : " ";
        var desc_por_prenda = params.has('desc_por_prenda') ? params.get('desc_por_prenda') : " ";
        var pagado_con = params.has('pagado_con') ? params.get('pagado_con') : "--";
        var a_cuenta_dos = params.has('a_cuenta_dos') ? params.get('a_cuenta_dos') : " ";
        var pagado_con_dos = params.has('pagado_con_dos') ? params.get('pagado_con_dos') : "--";
        var porcent_desc = params.has('porcent_desc') ? params.get('porcent_desc') : " ";
        var porcent_desc_plata = params.has('porcent_desc_plata') ? params.get('porcent_desc_plata') : " ";
        var total_por_pagar = params.has('total_por_pagar') ? params.get('total_por_pagar') : " ";
        var estado = params.has('estado') ? params.get('estado') : "--";
        var total_prendas = params.has('total_prendas') ? params.get('total_prendas') : "--";
        
        
        

        //Recibe los datos de los servicios (separados por comas)
        var cantidades = params.has('cantidades') ? params.get('cantidades') : "";
        var descripciones = params.has('servicios') ? params.get('servicios') : "";
        var detalle = params.has('detalles') ? params.get('detalles') : "";
        var p_units = params.has('p_unit') ? params.get('p_unit') : "";
        var subtotal = params.has('subtotal') ? params.get('subtotal') : "";
        
        //Formato de 2 decimales
        //total = parseFloat(total).toLocaleString('es-ES', { minimumFractionDigits: 2 });
        //descuento = parseFloat(descuento).toLocaleString('es-ES', { minimumFractionDigits: 2 });
        //subtotal_desc = parseFloat(subtotal_desc).toLocaleString('es-ES', { minimumFractionDigits: 2 });
        
        //crea una lista de cada columna a partir de las comas.
        cantidades = cantidades.split(",");
        descripciones = descripciones.split(",");
        detalle = detalle.split(",");
        p_units = p_units.split(",");

        //Crea una lista para mostrar en cada fila de la tabla
        var result = [];
        
        cantidades.forEach(function(value, id) {
            result[id] = {
                cantidad: cantidades[id],
                descripcion: descripciones[id], // + " " + detalles[id], // Descomenta si deseas concatenar la descripción con el detalle
                detalle: detalle[id],
                subtotal: subtotal[id],
                precio_unit: parseFloat(p_units[id]).toFixed(2),
              
            };
        });
    </script>
    
    <div id="header">
     <div class="button-container">
    <!-- Contenedor de botones -->
         <div class="button-box">
  <!-- Botón de WhatsApp con ícono -->
  <a href="#" id="impresoraButton">
  <img class="boton" src="Print.png" class="ImganelLogo" width= "60%" id "foto">
  </a>
  
  <!-- Botón existente de WhatsApp -->
  
  <a href="#" id="whatsappButton">
  <img class="boton" src="wsp.png" class="ImganelLogo" width= "60%" id "foto">
  </a>
    </div>
  </div>
</div>

     <!-- Agregamos el input oculto para la URL -->
    <input type="hidden" id="url" value="">
    
     <div id="thermal-pos">
        
        <div id="thermal-pos">
        
        <div class="label">
             <img class="boton" src="Wash.png" class="ImganelLogo" width= "60%" id "foto">
            <br/>
            <p class="info-tienda">
                 Jr Huiracocha 1371. Jesús Maria 
                <br>
              Razón social: R y V Wash Service SAC
               <br>
               Ruc: 20608166581
                <br>
                 Telefono: 902134117 / 940242033
        
                <br>
              
          
        </div>
        
        
        <div class="ticket">
            <b>TICKETT:<br>
            <h1 class="nro_boleta" id="nro_boleta_id" ></h1>
         </div>
        <div class="fecharecep">
            <p class="fecha">
                
                <b>FECHA RECEPCIOON:<br>
                <b id="fecha"></b>
            <br>
            <b>CLIENTE:<br>
            <h1 class="nombre-cliente" id="nombre_client">
            </h1>
        </div>

        <div class="label">
            <p class="fecha_entrega">
                <b> FECHA ENTREGA: <br>
                    <span id="fecha_entrega"></span>
                </b>
            </p>
        </div>
      
   
   
        <table class="table">
            <tbody id="tablaBody">
                <tr class="table-header">
    <th><h2>Cant</h2></th>
    <th><h2>Descripcion</h2></th>

    <th><h2>Precio</h2></th>
    <th><h2>Subtotal</h2></th> <!-- Nueva columna para Subtotal -->
                 </tr>
                <script>
                    /*var result = [
                        { cantidad: 3, descripcion: "Descripción 1", precio_unit: 10.50 },
                        { cantidad: 5, descripcion: "Descripción 2", precio_unit: 20.00 },
                        // ... otros objetos en el array
                    ];*/

                    var tablaBody = document.getElementById("tablaBody");

                    result.forEach(function(row) {
    var newRow = document.createElement("tr");
    newRow.className = "table-item";

    // Calcula el subtotal para el servicio actual
    var subtotal = row.cantidad * parseFloat(row.precio_unit);
    
    newRow.innerHTML = `

        
       <td class="item" style="text-align: left;">${row.cantidad}</td>
        <td class="item" style="text-align: left;">${row.descripcion}</td>

        <td class="item" style="text-align: right;">${row.precio_unit}</td> <!-- Alinea a la derecha -->
        <td class="item" style="text-align: right;">${subtotal.toFixed(2)}</td> <!-- Alinea a la derecha -->
    `;

    tablaBody.appendChild(newRow);
});

                document.querySelectorAll('.printbutton').forEach(function(element) {
            element.addEventListener('click', function() {
                /*print();*/
            });
        });
        
        /*MENSAJE DE WHATSAPP
                    ];*/
        
    </script>
                
     <!-- ... (INICIA EL CODIGO DE ACORTAR URL) ... -->

    <script>
    // Función para acortar la URL
    async function shortURL(url) {
        const response = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(url)}`);
        if (response.ok) {
            return await response.text();
        } else {
            throw new Error("Error al acortar la URL");
        }
    }

    // Modificamos la función para enviar el mensaje de WhatsApp
    async function sendWhatsAppMessage() {
        var currentURL = window.location.href;
        
        try {
            // Acortamos la URL actual
            var shortedURL = await shortURL(currentURL);
            
            var message = 'Hola!! somos de la lavandería, somos una lavandería que cuida el medio ambiente ♻️♻️♻️♻️♻️, por ello adjuntamos su ticket de atención virtual. Click en el link para ver el ticket 👇🏻👇🏻👇🏻 ' + shortedURL;
            
            var whatsappLink = 'https://api.whatsapp.com/send?phone=' + codigo_pais + telefono + '&text=' + encodeURIComponent(message);
            
            window.open(whatsappLink, '_blank');
        } catch (error) {
            console.error("Error al acortar la URL:", error);
            alert("Hubo un error al acortar la URL. Por favor, intente nuevamente.");
        }
    }

    // Asignamos la nueva función al evento click del botón
    document.getElementById('whatsappButton').addEventListener('click', sendWhatsAppMessage);

    <!-- ... (FINALIZA EL CODIGO DE ACORTAR URL) ... -->
    </script>
        


     
         <script>
    
    // Función para imprimir el ticket
function printTicket() {
  window.print();
}

// Asignar la función al evento click del botón de impresión
document.getElementById('impresoraButton').addEventListener('click', printTicket);
     
     
        
        
    </script>
    
    

                <tr class="table-footer top-line">
                    <td class="" colspan="3">Total Venta:</td>
                    <td colspan="3"><h2 id="total"></h2></td>
                </tr>

                <tr class="table-footer">
                    <td colspan="3"><h2>Desc x prenda:</h2></td>
                    <td colspan="3"><h2 id="desc_por_prenda"></h2></td>
                    
                </tr>
                 <tr class="table-footer">
                    <td colspan="3"><h2>Desc ticket:</h2></td>
                    <td colspan="3"><h2 id="subtotal_desc"></h2></td>
                    
                </tr>
                
                <tr class="table-footer">
                    <td colspan="3"><h2>A cuenta 1:</h2></td>
                    <td colspan="3"><h2 id="a_cuenta"></h2></td>
                    
                </tr>
                    <tr class="table-footer">
                    <td colspan="3"><h2>A cuenta 2:</h2></td>
                    <td colspan="3"><h2 id="a_cuenta_dos"></h2></td>  
             
                </tr>
                
                <tr class="table-footer">
                    <td colspan="3"><h2>Por Pagar</h2></td>
                    <td colspan="3"><h2 id="total_por_pagar"></h2></td>
                </tr>
                
                 
                
                <tr class="table-footer">
                    <td colspan="3"><h2 id=0></h2></td>
                    <td colspan="3"><h2 id="porcent_desc_plata"></h2></td>

                </tr>
                
                 <tr class="table-footer">
                    <td colspan="3"><h2></h2></td>
                    <td colspan="3"><h2 id="porcent_desc_plata"></h2></td>
                </tr>
                
                
            </tbody>
        </table>
        <br/>

        <p id="textOutput"> </p>
   

        <p class="saldo-text">
            <b><span class="estado-deuda" id="estado"></span></b>
        </p>
        <br/>
        <p class="prendas:">
            <b><span class="total_prendas" id="total_prendas"></span></b>
        </p>

       <div class="policy">
            <p class="policy-title">
                <b>IMPORTANTE_:</b>
            </p>
        
            <p class="m-0">
               1.- CONDICIONES DE LA LAVANDERÍA.
               <br/>
  
               <br/>
                <br/>
              
               
               
               
            </p>
    
        <div class="policy">
            <p class="policy-title">
                <b>GRACIAS POR SU PREFERENCIA!!</b>
            </p>
    </div>
    <script>
        var nroBoletaElement = document.getElementById("nro_boleta_id").textContent = nro_boleta;
        var fechaElement = document.getElementById("fecha").textContent = fecha;
        var nombre_clientElement = document.getElementById("nombre_client").textContent = nombre_cliente;
        var fecha_entregaElement = document.getElementById("fecha_entrega").textContent = fecha_entrega;
        

        var totalElement = document.getElementById("total");totalElement.textContent = parseFloat(total).toFixed(2);
        var subtotal_descElement = document.getElementById("subtotal_desc");subtotal_descElement.textContent = parseFloat(subtotal_desc).toFixed(2);
        var desc_por_prendaElement = document.getElementById("desc_por_prenda");desc_por_prendaElement.textContent = parseFloat(desc_por_prenda).toFixed(2);

        var a_cuentaElement = document.getElementById("a_cuenta");a_cuentaElement.textContent = parseFloat(a_cuenta).toFixed(2);
        var a_cuenta_dosElement = document.getElementById("a_cuenta_dos"); a_cuenta_dosElement.textContent = parseFloat(a_cuenta_dos).toFixed(2);


        var total_por_pagarElement = document.getElementById("total_por_pagar");total_por_pagarElement.textContent = parseFloat(total_por_pagar).toFixed(2);
        //var porcent_descElement = document.getElementById("porcent_desc").textContent = porcent_desc;
        //var porcent_desc_plataElement = document.getElementById("porcent_desc_plata").textContent = porcent_desc_plata;
           
        
        var estadoElement = document.getElementById("estado").textContent = estado;
        var total_prendasElement = document.getElementById("total_prendas").textContent = total_prendas;
      </script>   

<script>
// Obtén el botón de WhatsApp por su ID
var whatsappButton = document.getElementById('whatsappButton');
var impresoraButton = document.getElementById('impresoraButton');

// Obtén la URL actual
var currentURL = window.location.href;

// Verifica si la URL contiene "sharelink=1" y oculta el botón si es así
if (currentURL.indexOf('sharelink=1') !== -1) {
    whatsappButton.style.display = 'none';
    impresoraButton.style.display = 'none';
}
</script>

         <script>
    
    function convertToText() {
    const total_por_pagar = parseInt(document.getElementById('total_por_pagar').value);
    const textOutput = document.getElementById('textOutput');

    const ones = ["", "uno", "dos", "tres", "cuatro", "cinco", "seis", "siete", "ocho", "nueve"];
    const teens = ["diez", "once", "doce", "trece", "catorce", "quince", "dieciséis", "diecisiete", "dieciocho", "diecinueve"];
    const tens = ["", "", "veinte", "treinta", "cuarenta", "cincuenta", "sesenta", "setenta", "ochenta", "noventa"];
    const hundreds = ["", "cien", "doscientos", "trescientos", "cuatrocientos", "quinientos", "seiscientos", "setecientos", "ochocientos", "novecientos"];

    if (isNaN(total_por_pagar)) {
        textOutput.innerText = "Por favor, ingresa un número válido.";
        return;
    }

    if (total_por_pagar < 0 || total_por_pagar > 1000000000) {
        textOutput.innerText = "Este script solo soporta números entre 0 y 1,000,000,000.";
        return;
    }

    let text = "";

    if (total_por_pagar === 0) {
        text = "cero";
    } else if (total_por_pagar === 1000000000) {
        text = "mil millones";
    } else {
        const convertHundreds = (n) => {
            if (n < 10) return ones[n];
            else if (n >= 10 && n < 20) return teens[n - 10];
            else if (n >= 20 && n < 100) return tens[Math.floor(n / 10)] + (n % 10 > 0 ? " y " + ones[n % 10] : "");
            else if (n >= 100) {
                const hundred = Math.floor(n / 100);
                const remainder = n % 100;
                if (remainder === 0) return hundreds[hundred];
                else return hundreds[hundred] + " " + convertHundreds(remainder);
            }
        };

        const convertThousands = (n) => {
            const thousands = Math.floor(n / 1000);
            const remainder = n % 1000;

            let text = "";
            if (thousands > 0) {
                if (thousands === 1) text += "mil ";
                else text += convertHundreds(thousands) + " mil ";
            }

            text += convertHundreds(remainder);
            return text;
        };

        const millions = Math.floor(total_por_pagar / 1000000);
        const remainder = total_por_pagar % 1000000;

        if (millions > 0) {
            if (millions === 1) text += "un millón ";
            else text += convertHundreds(millions) + " millones ";
        }

        text += convertThousands(remainder);
    }

    textOutput.innerText = text.trim().charAt(0).toUpperCase() + text.trim().slice(1)+ " soles " ;
}

</script>


         
</body>
</html>
